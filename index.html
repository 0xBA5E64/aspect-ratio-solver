<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aspect Ratio Solver - By Dovah Akesi Zuulkin</title>
  <style>

.ratio {
  display: inline-block;
  width: 16px;
  height: 16px;
  background: #00F2;
  margin: 1px;
  text-align: center;
  overflow: hidden;
  font-size: 8px;
}

  </style>
  <script>

// Generate the HTML table to show all aspect ratios
// returns an element to be appended to the DOM
const genRatioGrid = (max_ratio) => {
  const rg_root_element = document.createElement('table')

  for(let y = 1; y<=max_ratio; y++) {
    const rg_row_element = document.createElement('tr');
    for(let x = 1; x<=max_ratio; x++) {
      const rg_ratio_element = document.createElement('td');
      rg_ratio_element.innerText = `${x}:${y}`
      rg_ratio_element.classList.add('ratio');
      rg_row_element.appendChild(rg_ratio_element);
    }
    rg_root_element.appendChild(rg_row_element);
  }
  return rg_root_element;
}

// Create a sorted list of the error per each aspect-ratio
const createAccuracyRanking = (max_ratio = 32) => {

  // Parse input and calculate decimal aspect-ratio
  const x_in = parseInt(document.querySelector("#src-x").value)
  const y_in = parseInt(document.querySelector("#src-y").value)
  const ratio_inraw = x_in / y_in
  if (ratio_inraw === NaN ) { return }

  const ranked_list = []
  let i = 0
  for(let iy = 1; iy<=max_ratio; iy++) {
    for(let ix = 1; ix<=max_ratio; ix++) {
      ranked_list.push({
        i: i++,
        x: ix,
        y: iy,
        error: Math.abs(ratio_inraw - ( ix / iy ))
      })
    }
  }
  
  ranked_list.sort((a, b) => { return a.error - b.error }) // Sort list based on error value: low to high
  console.log(ranked_list) // Debug, very useful though, so leave this here for the forseeable future
  return ranked_list;
}

// Render the top "ratio_count" ratios on the RatioGrid DOM element
const visualizeAccuracyRanking = (ranked_list, table_element, ratio_count = 16, filter_repetition = true) => {

  table_element.querySelectorAll('.ratio').forEach((ratio_element) => {ratio_element.style.background = 'white'})

  for(let i = 0; i<ratio_count; i++) {
    // Filter out potential repeating occurances of aspect ratios, eg: 4:3 -> 8:6 -> 12:9
    // Usually, the user will be looking for the lowest-numbered aspect ratio you can get, so this is the default.
    // TODO: Filter out potential edgecases, such as 18:9 being more commonly desired than 2:1
    if(filter_repetition && i>=1) {
      if (ranked_list[i].error == ranked_list[i-1].error) {
        console.log(`Skipping iteration: ${i}`)
        continue
      }
    }
    console.log(`Doing iteration: ${i}`)
    const ratio_element = table_element.querySelectorAll('tr')[ranked_list[i].y-1].querySelectorAll('td')[ranked_list[i].x-1];
    console.log(table_element.querySelectorAll('tr')[ranked_list[i].y-1].querySelectorAll('td')[ranked_list[i].x-1])
    console.log(ratio_element) 
    ratio_element.style.background = `rgb(${((i/ratio_count))*255}, ${(1-(i/ratio_count))*255}, 0)`;
    // 1-(i/ratio_count) 1 -> 0
  }
}

  </script>
</head>
<body>
  <input type="number" id="src-x" placeholder="Image Width (X)">
  <input type="number" id="src-y" placeholder="Image Height (Y)">
  <button id="finger">Calc!</button>
  <script>

const ratio_grid = genRatioGrid(32);
document.body.appendChild(ratio_grid)

document.querySelector("#finger").addEventListener('click', () => {
  const best_ratios = createAccuracyRanking(32)
  visualizeAccuracyRanking(best_ratios, ratio_grid, 16)
})

document.querySelector("#src-x").addEventListener('change', () => {
  const best_ratios = createAccuracyRanking(32)
  visualizeAccuracyRanking(best_ratios, ratio_grid, 16)
})

document.querySelector("#src-y").addEventListener('change', () => {
  const best_ratios = createAccuracyRanking(32)
  visualizeAccuracyRanking(best_ratios, ratio_grid, 16)
})


  </script>
</body>
</html>